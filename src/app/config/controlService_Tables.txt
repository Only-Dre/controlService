CREATE DATABASE service_control;

USE service_control;

CREATE TABLE patient(
	id BIGINT AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(100) NOT NULL,
	phone VARCHAR(15) NOT NULL
);

CREATE TABLE physiotherapist(
	id BIGINT AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(100) NOT NULL,
	email VARCHAR(100) NOT NULL,
	password VARCHAR(100) NOT NULL,
	technique VARCHAR(100) NOT NULL,
	commission DOUBLE NOT NULL
);


CREATE TABLE appointment(
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    patient_id BIGINT,
    physiotherapist_id BIGINT,
    technique VARCHAR(100) NOT NULL,
    date DATE NOT NULL,
    duration INT NOT NULL,
    value DOUBLE NOT NULL,
    net_value DOUBLE NOT NULL,

    /* Foreign Keys */
    FOREIGN KEY (patient_id) REFERENCES patient(id),
    FOREIGN KEY (physiotherapist_id) REFERENCES physiotherapist(id)
);

CREATE TABLE technique (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    value DOUBLE NOT NULL
);

CREATE TABLE physiotherapist_technique (
    physiotherapist_id BIGINT NOT NULL,
    technique_id BIGINT NOT NULL,

    PRIMARY KEY (physiotherapist_id, technique_id), -- Chave primária composta: a combinação fisio + técnica é única

    FOREIGN KEY (physiotherapist_id) REFERENCES physiotherapist(id),
    FOREIGN KEY (technique_id) REFERENCES technique(id)
);
